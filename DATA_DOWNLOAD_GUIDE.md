# A股数据下载与回测使用指南

## 🎯 项目概述

本项目实现了完整的A股量化交易系统，支持：
- **批量下载** A股所有股票和ETF的历史K线数据
- **定投策略** 回测不同指数的收益情况
- **MACD策略** 技术指标交易策略
- **专业回测** 基于VeighNa框架的回测引擎

## 📥 数据下载功能

### 1. 下载所有A股数据

```bash
# 下载所有股票和ETF数据（推荐）
python main.py --mode download
```

**下载内容：**
- 所有A股股票（约5000+只）
- 所有ETF基金（约300+只）
- 主要指数数据（沪深300、创业板指等）
- 数据时间范围：2015年至今

### 2. 下载配置

数据配置在 `config/config.py` 中：
```python
DATA_CONFIG = {
    'data_path': './data',           # 数据存储路径
    'start_date': '2015-01-01',      # 开始日期
    'end_date': '当前日期',          # 结束日期
    'max_workers': 10,               # 并行下载线程数
    'retry_times': 3,                # 重试次数
}
```

## 📊 数据存储结构

```
data/
├── stocks/           # 股票数据
│   ├── 000001.SH.csv
│   ├── 000002.SZ.csv
│   └── ...
├── etfs/            # ETF数据
│   ├── 510300.SH.csv
│   ├── 159915.SZ.csv
│   └── ...
├── index/           # 指数数据
│   ├── 000001.SH.csv
│   ├── 000300.SH.csv
│   └── ...
└── download_summary.json  # 下载摘要
```

## 🧪 定投策略回测

### 1. 运行定投回测

```bash
# 运行全面的定投策略回测
python backtesting/dca_backtest_engine.py
```

### 2. 回测内容

回测系统会自动测试：
- **热门指数**：沪深300、创业板指、中证500等
- **ETF组合**：主要ETF基金的定投表现
- **随机股票**：随机选择股票样本进行测试

### 3. 回测输出

回测完成后会输出：
- 📈 **收益率排名**：各指数的表现对比
- 📊 **统计分析**：平均收益率、最高/最低收益
- 💡 **策略建议**：投资建议和风险提示
- 🎨 **可视化图表**：收益率分布、排名图表

## 🔧 技术特性

### 数据获取
- **多线程下载**：支持并行下载，提高效率
- **断点续传**：失败自动重试，支持断点续传
- **数据验证**：下载后自动验证数据完整性
- **本地缓存**：数据本地存储，避免重复下载

### 回测引擎
- **真实数据**：使用实际历史数据进行回测
- **多策略支持**：支持定投、MACD等多种策略
- **风险控制**：包含止损止盈等风险控制机制
- **专业评估**：提供专业的绩效评估指标

## 🚀 快速开始

### 第一步：下载数据
```bash
python main.py --mode download
```

### 第二步：运行回测
```bash
python run.py --mode dca_backtest
```

### 第三步：查看结果
- 查看控制台输出的详细报告
- 查看生成的图表和分析
- 根据建议调整投资策略

## 💡 使用建议

### 数据下载
1. **网络要求**：确保稳定的网络连接
2. **存储空间**：需要约2-3GB的存储空间
3. **时间预估**：完整下载约需30-60分钟

### 回测策略
1. **长期视角**：定投策略适合长期投资（3-5年）
2. **分散投资**：建议投资多个指数或ETF
3. **定期评估**：每半年评估一次策略表现

### 风险提示
1. **历史不代表未来**：回测结果仅供参考
2. **市场风险**：投资有风险，需谨慎决策
3. **充分测试**：建议多种策略组合测试

## 🔄 更新与维护

### 数据更新
```bash
# 更新到最新数据
python main.py --mode download
```

### 添加新策略
1. 在 `strategies/` 目录下创建新策略
2. 在回测引擎中集成新策略
3. 测试验证策略效果

## 🆘 常见问题

### Q: 下载过程中失败怎么办？
A: 程序会自动重试，也可以重新运行下载命令

### Q: 数据存储在哪里？
A: 数据存储在 `./data` 目录下

### Q: 如何查看已下载的数据？
A: 运行 `python utils/data_fetcher.py` 查看摘要

### Q: 回测结果如何解读？
A: 重点关注收益率、年化收益、定投优势等指标

## 📞 技术支持

如有问题请检查：
1. 依赖包是否安装完整
2. 网络连接是否正常
3. 存储空间是否充足
4. 查看日志文件 `data_download.log`

---

**开始您的量化投资之旅吧！** 🎯